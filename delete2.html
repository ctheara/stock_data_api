<!DOCTYPE HTML>
<html>
<head>  
    

</head>
<body>
    
    <h1>Stock</h1>
    <div id="info"></div>
    <input type = "submit" value = "Submit" onclick="getInfo()"> 

    <div id="chartContainer" style="height: 370px; width: 100%;"></div>
    <script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>



    <script>

        function getInfo(){
            const data = null;

            const xhr = new XMLHttpRequest();
            xhr.withCredentials = false;

            xhr.onreadystatechange = function() {

            // if request is successful
                 if (this.readyState == 4 && this.status == 200) {
                    recordStr = this.responseText;
                    record = JSON.parse(recordStr); // Create JS object


                    //test to get first timestamp
                        msg = "<b><u>Result:</b></u> <br>Timestamp: " + record.chart.result[0].timestamp[0] +"<br>";

                    //first timestamp
                    let timeTest = record.chart.result[0].timestamp[9];
                    var myDate = new Date(timeTest*1000);
                    let dateArray = myDate.toLocaleString().split("/") +"<br>";

                    let year = myDate.getFullYear();
                    let month = myDate.getMonth();
                    let day = myDate.getDay();

                    msg += "Date: " +myDate +"<br>";
                    msg += year +"<br>";
                    msg += month +"<br>";
                    msg += day +"<br>";

                    //test to get one timestamp
                    msg += "<b><u>Result:</b></u> <br>Price: " + record.chart.result[0].indicators.quote[0].open[0] +"<br>";



                    let dataPointList = [];


                    //test to get all price
                    msg += "Prices: ";
                        for (var i = 0; i < record.chart.result[0].indicators.quote[0].open.length; i++) {
                            //msg += record.chart.result[0].indicators.quote[0].open[i];
                            let price = record.chart.result[0].indicators.quote[0].open[i].toString().slice(0,4);
                            dataPointList.push({y:parseFloat(price)});
                            //msg += price
                            if (i + 1 != record.chart.result[0].indicators.quote[0].open.length) {
                                msg += "";
                            }
                        }

                    msg += dataPointList[8].y;


                    document.getElementById("info").innerHTML = msg;

                    //test DELETE
                    let testList = [{ y: 450 },{ y: 470 }]

                    //graphing chart
                    window.onload = function () {
                        var chart = new CanvasJS.Chart("chartContainer", {
                            animationEnabled: true,
                            theme: "light2",
                            title:{
                                text: "Simple Line Chart"
                            },
                            data: [{        
                                type: "line",
                                indexLabelFontSize: 16,
                                dataPoints: [
                                    { y: 450 },
                                    { y: 414},
                                    { y: 520, indexLabel: "\u2191 highest",markerColor: "red", markerType: "triangle" },
                                    { y: 460 },
                                    { y: 450 },
                                    { y: 500 },
                                    { y: 480 },
                                    { y: 480 },
                                    { y: 410 , indexLabel: "\u2193 lowest",markerColor: "DarkSlateGrey", markerType: "cross" },
                                    { y: 500 },
                                    { y: 480 },
                                    { y: 510 }
                                ]
                            }]
                        });
                        chart.render();
                        
                        }



                }

                else {
                    alert('error');
                    
                }





            };

            //Enter API key
            var api_key = "";

            

            xhr.open("GET", "https://yh-finance.p.rapidapi.com/stock/v2/get-chart?interval=1d&symbol=AMRN&range=5y&region=US");
            xhr.setRequestHeader("X-RapidAPI-Host", "yh-finance.p.rapidapi.com");
            xhr.setRequestHeader("X-RapidAPI-Key", api_key);

            xhr.send(data);

        };

        
        

    </script>
</body>
</html>